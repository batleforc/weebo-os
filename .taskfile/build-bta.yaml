version: "3"

tasks:
  oci:
    desc: "Build boot-c oci image"
    vars:
      folder: '{{.folder | default "fedora-bta" }}'
    cmds:
      - echo "Building boot-c image from folder {{ .folder }}"
      - sudo podman build -t localhost:8080/boot-c/{{ .folder }}:latest -f {{.folder}}/Containerfile {{.folder}}
  install-iso:
    desc: "Build boot-c install iso"
    vars:
      folder: '{{.folder | default "fedora-bta" }}'
    cmds:
      - echo "Building boot-c install iso"
      - sudo podman run
        --rm
        -it
        --privileged
        --pull=always
        --security-opt label=type:unconfined_t
        -v {{ .folder }}/config.toml:/config.toml:ro
        -v /var/lib/containers/storage:/var/lib/containers/storage
        -v ./output:/output
        quay.io/centos-bootc/bootc-image-builder:latest
        --type anaconda-iso
        --use-librepo=True
        localhost:8080/boot-c/{{ .folder }}:latest --rootfs xfs
