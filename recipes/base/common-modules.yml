modules:
  - type: script
    scripts:
      - prepare.sh

  - type: dnf
    repos:
      files:
        - https://packages.microsoft.com/yumrepos/vscode/config.repo
      keys:
        - https://packages.microsoft.com/keys/microsoft.asc
      copr:
        enable:
          - scottames/ghostty
          - atim/starship
          - dejan/lazygit
          - jdxcode/mise
    install:
      install-weak-deps: false
      packages:
        # terminal / shell
        - ghostty
        - starship
        #- bash-completion
        - fuzzel
        - swaylock

        # cli
        #- fzf
        - git
        #- curl
        - lazygit
        - neovim
        - tree-sitter-cli
        - clang
        # - eza Change the mean of install
        - btop
        - fastfetch
        - yq

        # utilities
        #- distrobox
        - mise
        #- nvtop
        - vlc

        # STEAM
        - steam-devices
        - steam

        # Browser
        - https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm

        # Rust !
        - rust
        - cargo
        - clippy
        - rust-src
        - rustfmt

        # IDE
        - code

        # Virtualization
        - qemu
        - qemu-kvm
        - gnome-boxes

        # 2D/3D Design
        - blender

        # Build tools
        - gcc
        - g++
        - cmake
        - libXrandr-devel
        - libXinerama-devel
        - libXcursor-devel
        - libXi-devel
        - mesa-libGL-devel
        - glew-devel
        - freeglut-devel
        - SDL2-devel
        - lz4-devel
        #- ffmpeg-free-devel
        - libXxf86vm-devel
        - glm-devel
        - glfw-devel
        - mpv
        - mpv-devel
        - pulseaudio-libs-devel
        - fftw-devel
        - gmp

    remove:
      packages:
        - firefox
        - firefox-langpacks

  - type: files
    files:
      - source: system
        destination: /

  - type: default-flatpaks
    configurations:
      - notify: true
        scope: system
        install:
          - org.gnome.Loupe
          - com.discordapp.Discord
          - io.github.dvlv.boxbuddyrs
          - com.obsproject.Studio
          - com.bambulab.BambuStudio
          - org.freecad.FreeCAD
          - org.gimp.GIMP
          - io.podman_desktop.PodmanDesktop
      - scope: user # Also add Flathub user repo, but no user packages

  - type: fonts
    fonts:
      nerd-fonts:
        - FiraCode

  # Enable Chezmoi for managing dotfiles
  - type: chezmoi
    repository: "https://github.com/batleforc/dotfiles"
    all-users: true
    file-conflict-policy: skip
  - type: gnome-extensions
    install:
      - 7065

  - type: script
    scripts:
      - ensureautoupdates.sh
      - default-editor.sh
      # Install binaries not available via dnf/flatpak (minimum vital tools)
      - binary/install-eza.sh
      - binary/install-kubectl.sh
      - binary/install-netbird.sh
      # Finalise image
      - addimageinfo.sh # Replace with https://blue-build.org/reference/modules/os-release/ ?
      - finalise.sh

  - type: signing
