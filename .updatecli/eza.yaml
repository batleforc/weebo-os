name: Update eza version

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: "{{ .github.owner }}"
      repository: "{{ .github.repository }}"
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: "main"

sources:
  eza:
    kind: githubrelease
    scmid: default
    spec:
      owner: eza-community
      repository: eza
      token: "{{ requiredEnv .github.token }}"
      versionfilter:
        kind: semver

targets:
  update-eza-script:
    name: Update eza version in install-eza.sh
    kind: file
    sourceid: eza
    scmid: default
    spec:
      file: files/scripts/install-eza.sh
      matchpattern: 'EZA_VERSION="v[0-9]+\.[0-9]+\.[0-9]+"'
      replacepattern: 'EZA_VERSION="{{ source `eza` }}"'

actions:
  bump-eza-version:
    kind: github/pullrequest
    scmid: default
    spec:
      title: "chore: update eza to {{ source `eza` }}"
      automerge: false
      description: |
        This PR updates the eza version in the install-eza.sh script to the latest version {{ source `eza` }}.
      labels:
        - dependencies
        - automated
